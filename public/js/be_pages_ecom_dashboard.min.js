/*!
 * dashmix - v5.5.0
 * @author pixelcave - https://pixelcave.com
 * Copyright (c) 2022
 */

function calcularRatio(visitas, pedidos) {
	return visitas.map((visit, index) => {
		return pedidos[index] !== 0 ? visit / pedidos[index] : 0; // Evita divisiones por cero
	});
}

const chart = async () => {
	let response = await fetch("/src/scripts/chart_data.php");
	let result = await response.json();
	let data = result.data;

	// Calculamos los nuevos arrays
	let ratio7 = calcularRatio(data["7visit"], data["7 days"]);
	let ratio14 = calcularRatio(data["14visit"], data["14 days"]);

	return { ratio7, ratio14 };
};

Dashmix.onLoad(() =>
	class {
		static async initOverviewChart() {
			let { ratio7, ratio14 } = await chart();
			(Chart.defaults.color = "#818d96"),
				(Chart.defaults.scale.grid.color = "transparent"),
				(Chart.defaults.scale.grid.zeroLineColor = "transparent"),
				(Chart.defaults.scale.beginAtZero = !0),
				(Chart.defaults.elements.point.radius = 0),
				(Chart.defaults.elements.point.hoverRadius = 0),
				(Chart.defaults.plugins.tooltip.radius = 3),
				(Chart.defaults.plugins.legend.labels.boxWidth = 12);
			let t,
				r,
				a,
				e = document.getElementById("js-chartjs-overview");
			(r = {
				maintainAspectRatio: !1,
				tension: 0.4,
				scales: { y: { suggestedMin: 0, suggestedMax: 50 } },
				interaction: { intersect: !1 },
				plugins: {
					tooltip: {
						callbacks: {
							label: function (t) {
								return t.parsed.y;
							},
						},
					},
				},
			}),
				(a = {
					labels: ["LUN", "MAR", "MIE", "JUE", "VIE", "SAB", "DOM"],
					datasets: [
						{
							label: "Esta Semana",
							fill: !0,
							backgroundColor: "rgba(6, 101, 208, .5)",
							borderColor: "transparent",
							pointBackgroundColor: "rgba(6, 101, 208, 1)",
							pointBorderColor: "#fff",
							pointHoverBackgroundColor: "#fff",
							pointHoverBorderColor: "rgba(6, 101, 208, 1)",
							data: ratio7,
						},
						{
							label: "Ãšltima Semana",
							fill: !0,
							backgroundColor: "rgba(6, 101, 208, .2)",
							borderColor: "transparent",
							pointBackgroundColor: "rgba(6, 101, 208, .2)",
							pointBorderColor: "#fff",
							pointHoverBackgroundColor: "#fff",
							pointHoverBorderColor: "rgba(6, 101, 208, .2)",
							data: ratio14,
						},
					],
				}),
				null !== e && (t = new Chart(e, { type: "line", data: a, options: r }));
		}
		static init() {
			this.initOverviewChart();
		}
	}.init()
);
